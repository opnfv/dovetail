From 151fea506b8cd367b0991555252b5987d2df58cd Mon Sep 17 00:00:00 2001
From: Alexandru Nemes <alexandru.nemes@enea.com>
Date: Thu, 10 Aug 2017 18:07:50 +0300
Subject: [PATCH] Add AArch64 support for Dovetail docker file

Signed-off-by: Alexandru Nemes <alexandru.nemes@enea.com>
---
 docker/Dockerfile | 28 ++++++++++++++++------------
 1 file changed, 16 insertions(+), 12 deletions(-)

diff --git a/docker/Dockerfile b/docker/Dockerfile
index c4b1121..95f6fdc 100644
--- a/docker/Dockerfile
+++ b/docker/Dockerfile
@@ -1,8 +1,15 @@
-FROM ubuntu:14.04
-MAINTAINER Leo Wang <grakiss.wanglei@huawei.com>
-LABEL version="0.1" description="OPNFV Dovetail Docker Container"
+FROM aarch64/ubuntu:16.04
+MAINTAINER Armband team <armband@enea.com>
+LABEL version="0.1" description="OPNFV Dovetail AArch64 Docker Container"
+
+RUN apt-get update

 ARG BRANCH=master
+ARG SUB_SOURCE_FILE=/etc/apt/sources.list.d/dovetail.list
+
+RUN touch $SUB_SOURCE_FILE
+RUN echo "deb [arch=arm64] https://download.docker.com/linux/ubuntu/ xenial test" >> ${SUB_SOURCE_FILE}
+RUN apt-get install -y apt-transport-https

 RUN \
     apt-get update \
@@ -17,19 +24,12 @@ RUN \
         python-dev \
         python-mock \
         python-pip \
-        apt-transport-https \
         wget \
+        sudo \
         --no-install-recommends \
 && \
-    apt-get update
+    apt-get update &&  apt-get -y install docker-ce --allow-unauthenticated

-RUN wget -qO- https://get.docker.com/ \
-| \
-    sed 's/-q docker-ce/-q docker-ce=17.03.0~ce-0~ubuntu-trusty/' \
-| \
-    sed 's/edge/stable/' \
-| \
-    sh

 ENV HOME /home/opnfv
 ENV REPOS_DIR ${HOME}/dovetail
@@ -38,6 +38,10 @@ WORKDIR /home/opnfv
 RUN \
     mkdir -p ${REPOS_DIR} \
 && \
+    pip install -U setuptools --upgrade \
+&& \
+    pip install -U wheel \
+&& \
     git config --global http.sslVerify false \
 && \
     pip install git+https://git.opnfv.org/dovetail@$BRANCH#egg=dovetail \