---

{% set validate_testcase = validate_testcase or '' %}
{% set testcase = testcase or '' %}
{% set deploy_scenario = deploy_scenario or 'unknown' %}

bottlenecks:
  image_name: opnfv/bottlenecks
  docker_tag: stable
  opts: '-id --privileged=true'
  envs: '-e DEPLOY_SCENARIO={{deploy_scenario}} -e Yardstick_TAG=stable -e OUTPUT_FILE={{testcase}}.out'
  volumes:
    - '-v /var/run/docker.sock:/var/run/docker.sock'
  config:
    dir: '/home/opnfv/userconfig'
  pre_condition:
    - 'cp /home/opnfv/userconfig/images/cirros-0.4.0-x86_64-disk.img /tmp/yardstick.img'
  cmds:
    - 'python /home/opnfv/bottlenecks/testsuites/run_testsuite.py testcase {{validate_testcase}} False'
  result:
    dir: '/tmp'
  openrc: '/tmp/admin_rc.sh'
  extra_container:
    - 'Bottlenecks-Yardstick'
    - 'Bottlenecks-ELK'
