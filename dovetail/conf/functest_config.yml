---
functest:
  image_name: opnfv/functest
  docker_tag: latest
  envs: '-e INSTALLER_TYPE=compass -e INSTALLER_IP=192.168.200.2
         -e NODE_NAME=dovetail-pod -e DEPLOY_SCENARIO=ha_nosdn
         -e BUILD_TAG=daily-dovetail-001 -e CI_DEBUG=true
         -e DEPLOY_TYPE=baremetal
         -e RESULTS_STORE=file:///home/opnfv/functest/results/functest_result.json'
  opts: '-id --privileged=true'
  pre_condition:
    - 'echo test for precondition in functest'
  cmds:
    - 'functest env prepare'
    - '[ -f /home/opnfv/functest/results/functest_result.json ] && cp /home/opnfv/functest/results/functest_result.json /home/opnfv/functest/functest_result.json || true'
    - sed -i 's/http:\/\/testresults.opnfv.org\/test\/api\/v1/file:\/\/\/home\/opnfv\/functest\/results\/functest_result.json/g' /home/opnfv/repos/functest/functest/ci/config_functest.yaml
    - 'functest testcase run {{validate_testcase}} -r'
    - 'cp /home/opnfv/functest/functest_result.json /home/opnfv/functest/results/functest_result.json'
  post_condition:
    - 'echo test for postcondition in functest'
  result:
    dir: '/home/opnfv/functest/results'
    store_type: 'file'
    file_path: 'functest_result.json'
    tp_path: 'tempest/tempest.log'
    db_url: 'http://testresults.opnfv.org/test/api/v1/results?case=%s&last=1'
  openrc: '/home/opnfv/functest/conf/openstack.creds'
